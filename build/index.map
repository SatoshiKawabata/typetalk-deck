{"version":3,"sources":["Actions.ts","typetalk/Streaming.ts","typetalk/Typetalk.ts","Api.ts","utils/utils.ts","components/molecules/Input.tsx","components/molecules/Post.tsx","components/organisms/PostList.tsx","components/organisms/TopicList.tsx","components/templates/Container.tsx","State.ts","index.ts"],"names":[],"mappings":"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","file":"index.map","sourcesContent":["import { IState, TabName } from \"./State\";\nimport { IMessageList, IPost, ITopics } from \"./typetalk/Models\";\n\n/**\n * APIの呼び出しはコンポーネント側で行い、ActionsではStateへの変更するだけに留めるのがいいのではないかと思っている\n */\nexport default class Actions {\n\n  private static getMessageListIndex(topicId: number, state: IState) {\n    let index = -1;\n    state.messageLists.find((list, i) => {\n      if (list.topic.id === topicId) {\n        index = i;\n        return true;\n      }\n    });\n    return index;\n  }\n\n  topics = (topics: ITopics) => (state: IState, actions: Actions) => {\n    return {\n      topics\n    };\n  }\n\n  tabName = (tabName: TabName) => (state: IState, actions: Actions) => {\n    state.view.tabName = tabName;\n    return {\n      view: state.view\n    };\n  }\n\n  replyInput = (replyTo: number) => (state: IState, actions: Actions) => {\n    state.view.replyInput = replyTo;\n    return {\n      view: state.view\n    };\n  }\n\n  unshiftMessageList = (messageList: IMessageList) => (state: IState, actions: Actions) => {\n    let idx;\n    const list = state.messageLists.find((l, i) => {\n      if (l.topic.id === messageList.topic.id) {\n        idx = i;\n        return true;\n      }\n    });\n    if (list) {\n      state.messageLists.splice(idx, 1);\n      state.messageLists.unshift(list);\n      return {\n        messageLists: state.messageLists\n      };\n    } else {\n      return {\n        messageLists: [messageList, ...state.messageLists]\n      };\n    }\n  }\n\n  messageList = (messageList: IMessageList) => (state: IState, actions: Actions) => {\n    const index = Actions.getMessageListIndex(messageList.topic.id, state);\n    if (state.messageLists[index]) {\n      // postsのマージ\n      const oldPosts = state.messageLists[index].posts;\n      const newPosts = messageList.posts;\n      const willAdd = [];\n      oldPosts.forEach(oldPost => {\n        if (newPosts.find(post => post.id === oldPost.id) === undefined) {\n          willAdd.push(oldPost);\n        }\n      });\n      newPosts.unshift(...willAdd);\n      newPosts.sort((a, b) => {\n        const aDate = new Date(a.createdAt);\n        const bDate = new Date(b.createdAt);\n        if (aDate > bDate) {\n          return 1;\n        } else {\n          return -1;\n        }\n      });\n    }\n    state.messageLists[index] = messageList;\n    return { messageLists: state.messageLists };\n  }\n\n  post = (post: IPost) => (state: IState, actions: Actions) => {\n    const messageList = state.messageLists.find(ml => ml.topic.id === post.topicId);\n    if (messageList) {\n      messageList.posts.push(post);\n      actions.messageList(messageList);\n    }\n  }\n}\n","import * as electron from \"electron\";\nimport { IPost, ISpace, ITalk, ITopic } from \"./Models\";\n\nexport default class Streaming {\n  start(callback: (msg: IStreaming) => void) {\n    electron.ipcRenderer.on(\"streaming-message\", (event, message) => {\n      callback(JSON.parse(message));\n    });\n  }\n}\n\nexport const StreamingEvent = {\n  ADD_TALK_POST: \"addTalkPost\",\n  CREATE_TALK: \"createTalk\",\n  DELATE_ATTACHMENT: \"deleteAttachment\",\n  DELETE_MESSAGE: \"deleteMessage\",\n  LIKE_MESSAGE: \"likeMessage\",\n  NOTIFY_MENTION: \"notifyMention\",\n  POST_LINK: \"postLinks\",\n  POST_MESSAGE: \"postMessage\",\n  READ_MENTION: \"readMention\",\n  SAVE_BOOKMARK: \"saveBookmark\",\n  SAVE_LIKES_BOOKMARK: \"saveLikesBookmark\",\n  UNLIKE_MESSAGE: \"unlikeMessage\",\n  UPDATE_MESSAGE: \"updateMessage\",\n  UPDATE_NOTIFICATION_ACCESS: \"updateNotificationAccess\",\n  UPDATE_SPACE: \"updateSpace\",\n  UPDATE_TALK: \"updateTalk\",\n  UPDATE_TOPIC: \"updateTopic\",\n};\n\nexport type StreamingEvent =\n  \"addTalkPost\" |\n  \"createTalk\" |\n  \"deleteAttachment\" |\n  \"deleteMessage\" |\n  \"likeMessage\" |\n  \"notifyMention\" |\n  \"postLinks\" |\n  \"postMessage\" |\n  \"readMention\" |\n  \"saveBookmark\" |\n  \"saveLikesBookmark\" |\n  \"unlikeMessage\" |\n  \"updateMessage\" |\n  \"updateNotificationAccess\" |\n  \"updateSpace\" |\n  \"updateTalk\" |\n  \"updateTopic\";\n\nexport interface IStreaming {\n  type: StreamingEvent;\n  data: any;\n}\n\nexport interface IpostMessage {\n  \"type\": \"postMessage\";\n  \"data\": {\n    \"space\": ISpace;\n    \"topic\": ITopic;\n    \"post\": IPost;\n    \"mentions\": any[];\n    \"exceedsAttachmentLimit\": boolean;\n    \"directMessage\": any;\n  };\n}\n\nexport interface IaddTalkPost extends IStreaming {\n  type: \"addTalkPost\";\n  data: {\n    topic: ITopic;\n    talk: ITalk;\n  };\n}\n\nexport interface IcreateTalk extends IStreaming {\n  type: \"createTalk\";\n  data: {\n    topic: ITopic;\n    talk: ITalk;\n    postIds: number[];\n  };\n}\n\nexport interface IdeleteAttachment extends IStreaming {\n  type: \"deleteAttachment\";\n  data: {\n    topic: ITopic;\n    post: IPost;\n    exceedsAttachmentLimit: boolean;\n  };\n}\n\nexport interface IdeleteMessage extends IStreaming {\n  type: \"deleteMessage\";\n  data: {\n    space: ISpace;\n    topic: ITopic;\n    post: IPost;\n    exceedsAttachmentLimit: boolean;\n  };\n}\n","import * as querystring from \"querystring\";\nimport { IAccessToken, IMessageList, IPost, IPostParam, IProfile, IReplies, ITopic, ITopics } from \"./Models\";\nimport Streaming, { IStreaming, StreamingEvent } from \"./Streaming\";\n\nconst secret = querystring.parse(location.search.split(\"?\")[1]);\nconst CLIENT_ID = secret.client_id;\nconst CLIENT_SECRET = secret.client_secret;\n\n/**\n * Typetalk api\n */\nexport default class TypeTalk {\n  private token!: IAccessToken;\n  private streaming: Streaming;\n  private streamingHandlers: Map<StreamingEvent, Array<(stream: IStreaming) => void>>;\n\n  constructor() {\n    this.streamingHandlers = new Map();\n  }\n\n  getToken() {\n    return this.postMethod<IAccessToken>(\"https://typetalk.com/oauth2/access_token\", {\n      client_id: CLIENT_ID,\n      client_secret: CLIENT_SECRET,\n      grant_type: \"client_credentials\",\n      scope: \"my,topic.read,topic.post\"\n    }).then((token) => {\n      this.token = token;\n      return token;\n    });\n  }\n\n  getProfile() {\n    return this.getMethod<IProfile>(\"https://typetalk.com/api/v1/profile\");\n  }\n\n  getTopics() {\n    return this.getMethod<ITopics>(\"https://typetalk.com/api/v1/topics\");\n  }\n\n  getMessageList(topicId: number, fromId: number = null) {\n    return this.getMethod<IMessageList>(`https://typetalk.com/api/v1/topics/${topicId}`,\n      fromId ? {from: fromId} : null\n    );\n  }\n\n  getPost(topicId: number, postId: number) {\n    return this.getMethod<IPost>(`https://typetalk.com/api/v1/topics/${topicId}/posts/${postId}`);\n  }\n\n  getReplies(topicId: number,  postId: number) {\n    return this.getMethod<IReplies>(`https://typetalk.com/api/v1/topics/${topicId}/posts/${postId}/replies`);\n  }\n\n  post(topicId: number, param: IPostParam) {\n    return this.postMethod<{\n      topic: ITopic,\n      psot: IPost,\n      mentions: string[]\n    }>(`https://typetalk.com/api/v1/topics/${topicId}`, param);\n  }\n\n  addEventListener(evtName: StreamingEvent, handler: (stream: IStreaming) => void) {\n    let handlers = this.streamingHandlers.get(evtName);\n    if (handlers) {\n      handlers.push(handler);\n    } else {\n      handlers = [handler];\n    }\n    this.streamingHandlers.set(evtName, handlers);\n  }\n\n  startStreaming() {\n    this.streaming = new Streaming();\n    this.streaming.start(msg => {\n\n      const handlers = this.streamingHandlers.get(msg.type);\n      if (handlers) {\n        handlers.forEach(h => {\n          h(msg);\n        });\n      }\n      // // debug\n      // console.log(msg);\n      // const data = localStorage.getItem(msg.type);\n      // if (!data) {\n      //   localStorage.setItem(msg.type, JSON.stringify(msg));\n      // }\n    });\n  }\n\n  private postMethod = <T>(url: string, param: any): Promise<T> => {\n    return new Promise<T>((res, rej) => {\n      const xhr = new XMLHttpRequest();\n      xhr.onload = () => {\n        res(JSON.parse(xhr.response));\n      };\n      xhr.onerror = () => {\n        rej(JSON.parse(xhr.response));\n      };\n      xhr.open(\"POST\", url);\n      if (this.token) {\n        xhr.setRequestHeader(\n          \"Authorization\",\n          `Bearer ${this.token.access_token}`\n        );\n      }\n      xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n      xhr.send(JSON.stringify(param));\n      return xhr;\n    });\n  }\n\n  private getMethod = <T>(url: string, query: any = null): Promise<T> => {\n    return new Promise<T>((res, rej) => {\n      const xhr = new XMLHttpRequest();\n      xhr.onload = () => {\n        res(JSON.parse(xhr.response));\n      };\n      xhr.onerror = () => {\n        rej(JSON.parse(xhr.response));\n      };\n      xhr.open(\"GET\", `${url}?${querystring.stringify(query)}`);\n      if (this.token) {\n        xhr.setRequestHeader(\n          \"Authorization\",\n          `Bearer ${this.token.access_token}`\n        );\n      }\n      xhr.send();\n      return xhr;\n    });\n  }\n}\n","import TypeTalk from \"./typetalk/Typetalk\";\n/**\n * Tyoetalkオブジェクトのインスタンス\n */\nexport const typetalkApi = new TypeTalk();\n","export const node2Array = (nodeList: NodeList): Node[] => {\n  const a = [];\n  for (let i = 0; i < nodeList.length; i++) {\n      a.push(nodeList[i]);\n  }\n  return a;\n};\n\nexport const isAddedToTop = (addedList: Node[], nodeList: NodeList): boolean => {\n  const list = node2Array(nodeList);\n  return addedList.some(node => {\n    return list.indexOf(node) === 0;\n  });\n};\n\nexport const classNames = (list: string[]): string => {\n  let result = \"\";\n  list.forEach(cn => {\n    result += cn + \" \";\n  });\n  return result;\n};\n","import { h } from \"hyperapp\";\nimport Actions from \"../../Actions\";\nimport { typetalkApi } from \"../../Api\";\nimport { IPostParam, ITopic } from \"../../typetalk/Models\";\nimport \"./Input.css\";\n\nexport default ({ actions, topic, replyTo }: { topic: ITopic, actions: Actions, replyTo?: number}) => {\n\n  const localState = {\n    message: \"\"\n  };\n\n  const post = async (textarea: HTMLTextAreaElement) => {\n    textarea.disabled = true;\n    const param: IPostParam = {\n      message: localState.message\n    };\n    if (replyTo) {\n      param.replyTo = replyTo;\n    }\n    await typetalkApi.post(topic.id, param);\n    textarea.disabled = false;\n    textarea.value = \"\";\n  };\n\n  return (\n    <div\n      class=\"Input\"\n      oncreate={(elm: HTMLElement) => {elm.querySelector(\"textarea\").focus(); }}>\n      <textarea\n        oninput={(e: KeyboardEvent) => {\n          localState.message = (e.target as HTMLTextAreaElement).value;\n        }}\n        onkeydown={(e: KeyboardEvent) => {\n          // valueに入力したテキストがちゃんと入ってくるために遅延させる\n          setTimeout(async () => {\n            if (e.keyCode === 13 && !e.shiftKey) { // Enterキー\n              post(e.target as HTMLTextAreaElement);\n            }\n          }, 1);\n        }}/>\n      <button\n        type=\"button\"\n        onclick={(e: Event) => {\n          const textarea = (e.target as HTMLElement).parentElement.querySelector(\"textarea\");\n          post(textarea);\n        }}>Post</button>\n    </div>\n  );\n};\n","import { h } from \"hyperapp\";\nimport Actions from \"../../Actions\";\nimport { typetalkApi } from \"../../Api\";\nimport { IView } from \"../../State\";\nimport { IPost } from \"../../typetalk/Models\";\nimport \"./Post.css\";\n\nexport default ({post, isObserve, actions, view}: {post: IPost, isObserve: boolean, actions: Actions, view: IView}) => {\n  const oncreate = isObserve ?\n    (elm: HTMLElement) => {\n      const io = new IntersectionObserver(async entries => {\n          if (entries[0].isIntersecting) {\n            io.disconnect();\n            const messageList = await typetalkApi.getMessageList(post.topicId, post.id);\n            actions.messageList(messageList);\n          }\n        });\n      io.observe(elm);\n    }\n    : null;\n  return (\n    <div class=\"Post\" oncreate={oncreate}>\n      <div class=\"Post__thumbnail-container\">\n        <img src={post.account.imageUrl} alt={post.account.fullName} />\n      </div>\n      <button\n        type=\"button\"\n        class=\"Post__post-container\"\n        onclick={() => {\n          console.log(\"onclick\", post);\n          if (view.replyInput === post.id) {\n            actions.replyInput(null);\n          } else {\n            actions.replyInput(post.id);\n          }\n        }}>\n        <p>{post.account.fullName}</p>\n        <p class=\"Post__post-message\">{post.message}</p>\n      </button>\n    </div>\n  );\n};\n","import { h } from \"hyperapp\";\nimport Actions from \"../../Actions\";\nimport { IView } from \"../../State\";\nimport { IMessageList } from \"../../typetalk/Models\";\nimport { isAddedToTop, node2Array } from \"../../utils/utils\";\nimport Input from \"../molecules/Input\";\nimport Post from \"../molecules/Post\";\nimport \"./PostList.css\";\n\nexport default ({list, actions, view}: {list: IMessageList, actions: Actions, view: IView}) => {\n  return [\n    <div class=\"PostList__title\">\n      {list.topic.name}\n    </div>,\n    <ul\n      class=\"PostList__scroll\"\n      oncreate={(elm: HTMLElement) => {\n        elm.scrollTop = Number.MAX_SAFE_INTEGER;\n        const mo = new MutationObserver(mutations => {\n          console.log(\"mutations\", elm.scrollHeight);\n          let addedHeight = 0;\n          const isTop = isAddedToTop(mutations.map(m => m.addedNodes[0]), elm.childNodes);\n          if (isTop) {\n            mutations.forEach(m => {\n              if (m.addedNodes.length) {\n                node2Array(m.addedNodes).forEach(node => {\n                  addedHeight += (node as HTMLElement).offsetHeight;\n                });\n              }\n            });\n            elm.scrollTop += addedHeight;\n          }\n        });\n        mo.observe(elm, {\n          childList: true\n        });\n      }}\n      >\n      {\n        list.posts.map((post, i) => (\n          <li\n            key={post.id}\n            oncreate={(elm: HTMLElement) => {\n              // draw reply line\n              if (elm.children[0].classList.contains(\"PostList__reply-line--unconnected\")) {\n                (elm.children[0] as HTMLElement).style.height = `${10}px`;\n              } else if (elm.children[0].classList.contains(\"PostList__reply-line\")) {\n                const parent = elm.parentElement;\n                const replyTo = parent.children[i - 1] as HTMLElement;\n                const height = elm.offsetTop - replyTo.offsetTop - 40;\n                (elm.children[0] as HTMLElement).style.height = `${height}px`;\n              }\n            }}>\n            {(() => {\n              // draw reply line\n              const prev = list.posts[i - 1];\n              if (prev && post.replyTo === prev.id) {\n                // draw line\n                return <div class=\"PostList__reply-line\"></div>;\n              } else if (post.replyTo) {\n                return <div class=\"PostList__reply-line PostList__reply-line--unconnected\"></div>;\n              }\n            })()}\n            <Post post={post} isObserve={i === 0} actions={actions} view={view} />\n            {view.replyInput === post.id\n              ? <Input actions={actions} topic={list.topic} replyTo={view.replyInput}/>\n              : null}\n          </li>\n        ))\n      }\n    </ul>,\n    <Input actions={actions} topic={list.topic} />\n  ];\n};\n","import { h } from \"hyperapp\";\nimport Actions from \"../../Actions\";\nimport { typetalkApi } from \"../../Api\";\nimport { IState } from \"../../State\";\nimport \"./TopicList.css\";\n\nexport default ({state, actions}: {state: IState, actions: Actions}) => {\n\n  const visibleTopics = (() => {\n    if (state.topics && state.view.tabName === \"all\") {\n      return state.topics.topics.filter((topic) => !topic.favorite);\n    } else if (state.topics && state.view.tabName === \"favorites\") {\n      return state.topics.topics.filter((topic) => topic.favorite);\n    } else {\n      return [];\n    }\n  })();\n\n  return [\n    <ul>\n      <li>\n        <button\n          class={\n            state.view.tabName === \"all\"\n            ? \"TopicList__tablist--selected\" : null\n          }\n          type=\"button\"\n          onclick={() => { actions.tabName(\"all\"); }}>All</button>\n      </li>\n      <li>\n        <button\n          class={\n            state.view.tabName === \"favorites\"\n            ? \"TopicList__tablist--selected\" : null\n          }\n          type=\"button\"\n          onclick={() => { actions.tabName(\"favorites\"); }}>Favorites</button>\n      </li>\n    </ul>,\n    <ul class=\"TopicList__list\">\n      {\n        visibleTopics.map((topic) => (\n          <li>\n            <button\n              type=\"button\"\n              onclick={async () => {\n                const messageList = await typetalkApi.getMessageList(topic.topic.id);\n                actions.unshiftMessageList(messageList);\n              }}>\n              {topic.topic.name}\n            </button>\n            <span>{topic.unread.count}</span>\n          </li>\n        ))\n      }\n    </ul>\n  ];\n};\n","import { h } from \"hyperapp\";\nimport Actions from \"../../Actions\";\nimport { IState } from \"../../State\";\nimport PostList from \"../organisms/PostList\";\nimport TopicList from \"../organisms/TopicList\";\nimport \"./Container.css\";\n\nexport default (state: IState, actions: Actions) => {\n  console.log(state);\n  return (\n    <div class=\"Container\">\n      <div class=\"Container__topic-list\">\n        <TopicList state={state} actions={actions} />\n      </div>\n      {\n        state.messageLists.map(list => {\n          return (\n            <div class=\"Container__post-list\" key={list.topic.id}>\n              <PostList list={list} actions={actions} view={state.view} />\n            </div>\n          );\n        })\n      }\n    </div>\n  );\n};\n","import { IMessageList, IReplies, ITopics } from \"./typetalk/Models\";\n\nexport type TabName = \"all\" | \"favorites\";\n\nexport interface IView {\n  tabName: TabName;\n  replyInput: number; // postId\n}\n\nexport interface IState {\n  topics: ITopics;\n  messageLists: IMessageList[];\n  replies: IReplies;\n  view: IView;\n}\n\n/**\n * アプリケーション全体の状態\n * 一個のでっかいJSON\n */\nexport const state: IState = {\n  messageLists: [],\n  topics: null,\n  replies: null,\n  view: {\n    tabName: \"favorites\",\n    replyInput: null\n  }\n};\n","import { app } from \"hyperapp\";\nimport Actions from \"./Actions\";\nimport { typetalkApi } from \"./Api\";\nimport Container from \"./components/templates/Container\";\nimport { state } from \"./State\";\nimport { IpostMessage } from \"./typetalk/Streaming\";\n\nconst actions: Actions = app(state, new Actions(), Container, document.body);\n\n// initialize\n(async () => {\n  await typetalkApi.getToken();\n\n  // トピックを取得\n  const topics = await typetalkApi.getTopics();\n  actions.topics(topics);\n\n  // Streaming apiからイベントを受け取る\n  typetalkApi.startStreaming();\n  typetalkApi.addEventListener(\"postMessage\", stream => {\n    const { data } = stream as IpostMessage;\n    actions.post(data.post);\n  });\n})();\n"]}